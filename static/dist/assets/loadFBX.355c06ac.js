import{y as at,V as he,al as Gn,f as bn,am as wt,g as Vn,an as jn,ao as Ot,ag as Ut,ap as Gt,aq as ot,ar as Xn,t as ce,v as ke,as as Zn,M as U,at as bt,au as Vt,av as Je,O as lt,aw as Hn,K as Kn,ax as jt,ay as ie,az as Wn,aA as qn,aB as Yn,c as $n,L as Qn,e as Jn,aC as Nn,aD as _n,b as He,F as ye,aE as er,h as tr,aF as nr,Q as Ke,E as ze,aG as rr,aH as ir,aI as ar,o as sr,p as or,q as Xt,aJ as lr,aK as cr,r as ur}from"./index.ce3b3605.js";import{c as fr}from"./cloneSkinnedMesh.3c33c4fe.js";/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.6.9
*/var Zt={},ht=function(r){return URL.createObjectURL(new Blob([r],{type:"text/javascript"}))},Nt=function(r){return new Worker(r)};try{URL.revokeObjectURL(ht(""))}catch{ht=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Nt=function(e){return new Worker(e,{type:"module"})}}var hr=function(r,e,t,n,i){var a=Nt(Zt[e]||(Zt[e]=ht(r)));return a.onerror=function(s){return i(s.error,null)},a.onmessage=function(s){return i(null,s.data)},a.postMessage(t,n),a},S=Uint8Array,V=Uint16Array,oe=Uint32Array,Ae=new S([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Fe=new S([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Be=new S([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_t=function(r,e){for(var t=new V(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new oe(t[30]),n=1;n<30;++n)for(var a=t[n];a<t[n+1];++a)i[a]=a-t[n]<<5|n;return[t,i]},en=_t(Ae,2),Tt=en[0],Ne=en[1];Tt[28]=258,Ne[258]=28;var tn=_t(Fe,0),nn=tn[0],pt=tn[1],Oe=new V(32768);for(var z=0;z<32768;++z){var ue=(z&43690)>>>1|(z&21845)<<1;ue=(ue&52428)>>>2|(ue&13107)<<2,ue=(ue&61680)>>>4|(ue&3855)<<4,Oe[z]=((ue&65280)>>>8|(ue&255)<<8)>>>1}var N=function(r,e,t){for(var n=r.length,i=0,a=new V(e);i<n;++i)++a[r[i]-1];var s=new V(e);for(i=0;i<e;++i)s[i]=s[i-1]+a[i-1]<<1;var o;if(t){o=new V(1<<e);var l=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],f=e-r[i],u=s[r[i]-1]++<<f,h=u|(1<<f)-1;u<=h;++u)o[Oe[u]>>>l]=c}else for(o=new V(n),i=0;i<n;++i)r[i]&&(o[i]=Oe[s[r[i]-1]++]>>>15-r[i]);return o},le=new S(288);for(var z=0;z<144;++z)le[z]=8;for(var z=144;z<256;++z)le[z]=9;for(var z=256;z<280;++z)le[z]=7;for(var z=280;z<288;++z)le[z]=8;var xe=new S(32);for(var z=0;z<32;++z)xe[z]=5;var rn=N(le,9,0),an=N(le,9,1),sn=N(xe,5,0),on=N(xe,5,1),Ye=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},J=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},$e=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},be=function(r){return(r/8|0)+(r&7&&1)},_=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r instanceof V?V:r instanceof oe?oe:S)(t-e);return n.set(r.subarray(e,t)),n},Ve=function(r,e,t){var n=r.length;if(!n||t&&!t.l&&n<5)return e||new S(0);var i=!e||t,a=!t||t.i;t||(t={}),e||(e=new S(n*3));var s=function(Ze){var Le=e.length;if(Ze>Le){var me=new S(Math.max(Le*2,Ze));me.set(e),e=me}},o=t.f||0,l=t.p||0,c=t.b||0,f=t.l,u=t.d,h=t.m,p=t.n,v=n*8;do{if(!f){t.f=o=J(r,l,1);var g=J(r,l+1,3);if(l+=3,g)if(g==1)f=an,u=on,h=9,p=5;else if(g==2){var m=J(r,l,31)+257,x=J(r,l+10,15)+4,P=m+J(r,l+5,31)+1;l+=14;for(var A=new S(P),I=new S(19),d=0;d<x;++d)I[Be[d]]=J(r,l+d*3,7);l+=x*3;for(var R=Ye(I),F=(1<<R)-1,j=N(I,R,1),d=0;d<P;){var L=j[J(r,l,F)];l+=L&15;var y=L>>>4;if(y<16)A[d++]=y;else{var M=0,E=0;for(y==16?(E=3+J(r,l,3),l+=2,M=A[d-1]):y==17?(E=3+J(r,l,7),l+=3):y==18&&(E=11+J(r,l,127),l+=7);E--;)A[d++]=M}}var O=A.subarray(0,m),k=A.subarray(m);h=Ye(O),p=Ye(k),f=N(O,h,1),u=N(k,p,1)}else throw"invalid block type";else{var y=be(l)+4,T=r[y-4]|r[y-3]<<8,w=y+T;if(w>n){if(a)throw"unexpected EOF";break}i&&s(c+T),e.set(r.subarray(y,w),c),t.b=c+=T,t.p=l=w*8;continue}if(l>v){if(a)throw"unexpected EOF";break}}i&&s(c+131072);for(var B=(1<<h)-1,Z=(1<<p)-1,W=l;;W=l){var M=f[$e(r,l)&B],Q=M>>>4;if(l+=M&15,l>v){if(a)throw"unexpected EOF";break}if(!M)throw"invalid length/literal";if(Q<256)e[c++]=Q;else if(Q==256){W=l,f=null;break}else{var H=Q-254;if(Q>264){var d=Q-257,te=Ae[d];H=J(r,l,(1<<te)-1)+Tt[d],l+=te}var ne=u[$e(r,l)&Z],q=ne>>>4;if(!ne)throw"invalid distance";l+=ne&15;var k=nn[q];if(q>3){var te=Fe[q];k+=$e(r,l)&(1<<te)-1,l+=te}if(l>v){if(a)throw"unexpected EOF";break}i&&s(c+131072);for(var X=c+H;c<X;c+=4)e[c]=e[c-k],e[c+1]=e[c+1-k],e[c+2]=e[c+2-k],e[c+3]=e[c+3-k];c=X}}t.l=f,t.p=W,t.b=c,f&&(o=1,t.m=h,t.d=u,t.n=p)}while(!o);return c==e.length?e:_(e,0,c)},re=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8},we=function(r,e,t){t<<=e&7;var n=e/8|0;r[n]|=t,r[n+1]|=t>>>8,r[n+2]|=t>>>16},Qe=function(r,e){for(var t=[],n=0;n<r.length;++n)r[n]&&t.push({s:n,f:r[n]});var i=t.length,a=t.slice();if(!i)return[se,0];if(i==1){var s=new S(t[0].s+1);return s[t[0].s]=1,[s,1]}t.sort(function(P,A){return P.f-A.f}),t.push({s:-1,f:25001});var o=t[0],l=t[1],c=0,f=1,u=2;for(t[0]={s:-1,f:o.f+l.f,l:o,r:l};f!=i-1;)o=t[t[c].f<t[u].f?c++:u++],l=t[c!=f&&t[c].f<t[u].f?c++:u++],t[f++]={s:-1,f:o.f+l.f,l:o,r:l};for(var h=a[0].s,n=1;n<i;++n)a[n].s>h&&(h=a[n].s);var p=new V(h+1),v=_e(t[f-1],p,0);if(v>e){var n=0,g=0,y=v-e,T=1<<y;for(a.sort(function(A,I){return p[I.s]-p[A.s]||A.f-I.f});n<i;++n){var w=a[n].s;if(p[w]>e)g+=T-(1<<v-p[w]),p[w]=e;else break}for(g>>>=y;g>0;){var m=a[n].s;p[m]<e?g-=1<<e-p[m]++-1:++n}for(;n>=0&&g;--n){var x=a[n].s;p[x]==e&&(--p[x],++g)}v=e}return[new S(p),v]},_e=function(r,e,t){return r.s==-1?Math.max(_e(r.l,e,t+1),_e(r.r,e,t+1)):e[r.s]=t},vt=function(r){for(var e=r.length;e&&!r[--e];);for(var t=new V(++e),n=0,i=r[0],a=1,s=function(l){t[n++]=l},o=1;o<=e;++o)if(r[o]==i&&o!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)s(32754);a>2&&(s(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(s(i),--a;a>6;a-=6)s(8304);a>2&&(s(a-3<<5|8208),a=0)}for(;a--;)s(i);a=1,i=r[o]}return[t.subarray(0,n),e]},Te=function(r,e){for(var t=0,n=0;n<e.length;++n)t+=r[n]*e[n];return t},Re=function(r,e,t){var n=t.length,i=be(e+2);r[i]=n&255,r[i+1]=n>>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var a=0;a<n;++a)r[i+a+4]=t[a];return(i+4+n)*8},gt=function(r,e,t,n,i,a,s,o,l,c,f){re(e,f++,t),++i[256];for(var u=Qe(i,15),h=u[0],p=u[1],v=Qe(a,15),g=v[0],y=v[1],T=vt(h),w=T[0],m=T[1],x=vt(g),P=x[0],A=x[1],I=new V(19),d=0;d<w.length;++d)I[w[d]&31]++;for(var d=0;d<P.length;++d)I[P[d]&31]++;for(var R=Qe(I,7),F=R[0],j=R[1],L=19;L>4&&!F[Be[L-1]];--L);var M=c+5<<3,E=Te(i,le)+Te(a,xe)+s,O=Te(i,h)+Te(a,g)+s+14+3*L+Te(I,F)+(2*I[16]+3*I[17]+7*I[18]);if(M<=E&&M<=O)return Re(e,f,r.subarray(l,l+c));var k,B,Z,W;if(re(e,f,1+(O<E)),f+=2,O<E){k=N(h,p,0),B=h,Z=N(g,y,0),W=g;var Q=N(F,j,0);re(e,f,m-257),re(e,f+5,A-1),re(e,f+10,L-4),f+=14;for(var d=0;d<L;++d)re(e,f+3*d,F[Be[d]]);f+=3*L;for(var H=[w,P],te=0;te<2;++te)for(var ne=H[te],d=0;d<ne.length;++d){var q=ne[d]&31;re(e,f,Q[q]),f+=F[q],q>15&&(re(e,f,ne[d]>>>5&127),f+=ne[d]>>>12)}}else k=rn,B=le,Z=sn,W=xe;for(var d=0;d<o;++d)if(n[d]>255){var q=n[d]>>>18&31;we(e,f,k[q+257]),f+=B[q+257],q>7&&(re(e,f,n[d]>>>23&31),f+=Ae[q]);var X=n[d]&31;we(e,f,Z[X]),f+=W[X],X>3&&(we(e,f,n[d]>>>5&8191),f+=Fe[X])}else we(e,f,k[n[d]]),f+=B[n[d]];return we(e,f,k[256]),f+B[256]},ln=new oe([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),se=new S(0),cn=function(r,e,t,n,i,a){var s=r.length,o=new S(n+s+5*(1+Math.ceil(s/7e3))+i),l=o.subarray(n,o.length-i),c=0;if(!e||s<8)for(var f=0;f<=s;f+=65535){var u=f+65535;u<s?c=Re(l,c,r.subarray(f,u)):(l[f]=a,c=Re(l,c,r.subarray(f,s)))}else{for(var h=ln[e-1],p=h>>>13,v=h&8191,g=(1<<t)-1,y=new V(32768),T=new V(g+1),w=Math.ceil(t/3),m=2*w,x=function(st){return(r[st]^r[st+1]<<w^r[st+2]<<m)&g},P=new oe(25e3),A=new V(288),I=new V(32),d=0,R=0,f=0,F=0,j=0,L=0;f<s;++f){var M=x(f),E=f&32767,O=T[M];if(y[E]=O,T[M]=E,j<=f){var k=s-f;if((d>7e3||F>24576)&&k>423){c=gt(r,l,0,P,A,I,R,F,L,f-L,c),F=d=R=0,L=f;for(var B=0;B<286;++B)A[B]=0;for(var B=0;B<30;++B)I[B]=0}var Z=2,W=0,Q=v,H=E-O&32767;if(k>2&&M==x(f-H))for(var te=Math.min(p,k)-1,ne=Math.min(32767,f),q=Math.min(258,k);H<=ne&&--Q&&E!=O;){if(r[f+Z]==r[f+Z-H]){for(var X=0;X<q&&r[f+X]==r[f+X-H];++X);if(X>Z){if(Z=X,W=H,X>te)break;for(var Ze=Math.min(H,X-2),Le=0,B=0;B<Ze;++B){var me=f-H+B+32768&32767,Un=y[me],zt=me-Un+32768&32767;zt>Le&&(Le=zt,O=me)}}}E=O,O=y[E],H+=E-O+32768&32767}if(W){P[F++]=268435456|Ne[Z]<<18|pt[W];var Rt=Ne[Z]&31,Bt=pt[W]&31;R+=Ae[Rt]+Fe[Bt],++A[257+Rt],++I[Bt],j=f+Z,++d}else P[F++]=r[f],++A[r[f]]}}c=gt(r,l,a,P,A,I,R,F,L,f-L,c),!a&&c&7&&(c=Re(l,c+1,se))}return _(o,0,n+be(c)+i)},un=function(){for(var r=new oe(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(t&1&&3988292384)^t>>>1;r[e]=t}return r}(),Pe=function(){var r=-1;return{p:function(e){for(var t=r,n=0;n<e.length;++n)t=un[t&255^e[n]]^t>>>8;r=t},d:function(){return~r}}},xt=function(){var r=1,e=0;return{p:function(t){for(var n=r,i=e,a=t.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=n+=t[s];n=(n&65535)+15*(n>>16),i=(i&65535)+15*(i>>16)}r=n,e=i},d:function(){return r%=65521,e%=65521,(r&255)<<24|r>>>8<<16|(e&255)<<8|e>>>8}}},ge=function(r,e,t,n,i){return cn(r,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):12+e.mem,t,n,!i)},je=function(r,e){var t={};for(var n in r)t[n]=r[n];for(var n in e)t[n]=e[n];return t},Ht=function(r,e,t){for(var n=r(),i=r.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),s=0;s<n.length;++s){var o=n[s],l=a[s];if(typeof o=="function"){e+=";"+l+"=";var c=o.toString();if(o.prototype)if(c.indexOf("[native code]")!=-1){var f=c.indexOf(" ",8)+1;e+=c.slice(f,c.indexOf("(",f))}else{e+=c;for(var u in o.prototype)e+=";"+l+".prototype."+u+"="+o.prototype[u].toString()}else e+=c}else t[l]=o}return[e,t]},We=[],pr=function(r){var e=[];for(var t in r)(r[t]instanceof S||r[t]instanceof V||r[t]instanceof oe)&&e.push((r[t]=new r[t].constructor(r[t])).buffer);return e},fn=function(r,e,t,n){var i;if(!We[t]){for(var a="",s={},o=r.length-1,l=0;l<o;++l)i=Ht(r[l],a,s),a=i[0],s=i[1];We[t]=Ht(r[o],a,s)}var c=je({},We[t][1]);return hr(We[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,c,pr(c),n)},De=function(){return[S,V,oe,Ae,Fe,Be,Tt,nn,an,on,Oe,N,Ye,J,$e,be,_,Ve,Ee,ve,It]},Se=function(){return[S,V,oe,Ae,Fe,Be,Ne,pt,rn,le,sn,xe,Oe,ln,se,N,re,we,Qe,_e,vt,Te,Re,gt,be,_,cn,ge,Xe,ve]},hn=function(){return[At,Pt,C,Pe,un]},pn=function(){return[Ft,mn]},vn=function(){return[Dt,C,xt]},gn=function(){return[yn]},ve=function(r){return postMessage(r,[r.buffer])},It=function(r){return r&&r.size&&new S(r.size)},Ce=function(r,e,t,n,i,a){var s=fn(t,n,i,function(o,l){s.terminate(),a(o,l)});return s.postMessage([r,e],e.consume?[r.buffer]:[]),function(){s.terminate()}},ee=function(r){return r.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return r.push(e.data[0],e.data[1])}},Me=function(r,e,t,n,i){var a,s=fn(r,n,i,function(o,l){o?(s.terminate(),e.ondata.call(e,o)):(l[1]&&s.terminate(),e.ondata.call(e,o,l[0],l[1]))});s.postMessage(t),e.push=function(o,l){if(a)throw"stream finished";if(!e.ondata)throw"no stream handler";s.postMessage([o,a=l],[o.buffer])},e.terminate=function(){s.terminate()}},K=function(r,e){return r[e]|r[e+1]<<8},b=function(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0},ct=function(r,e){return b(r,e)+b(r,e+4)*4294967296},C=function(r,e,t){for(;t;++e)r[e]=t,t>>>=8},At=function(r,e){var t=e.filename;if(r[0]=31,r[1]=139,r[2]=8,r[8]=e.level<2?4:e.level==9?2:0,r[9]=3,e.mtime!=0&&C(r,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){r[3]=8;for(var n=0;n<=t.length;++n)r[n+10]=t.charCodeAt(n)}},Ft=function(r){if(r[0]!=31||r[1]!=139||r[2]!=8)throw"invalid gzip data";var e=r[3],t=10;e&4&&(t+=r[10]|(r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},mn=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Pt=function(r){return 10+(r.filename&&r.filename.length+1||0)},Dt=function(r,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;r[0]=120,r[1]=n<<6|(n?32-2*n:1)},yn=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function St(r,e){return!e&&typeof r=="function"&&(e=r,r={}),this.ondata=e,r}var ae=function(){function r(e,t){!t&&typeof e=="function"&&(t=e,e={}),this.ondata=t,this.o=e||{}}return r.prototype.p=function(e,t){this.ondata(ge(e,this.o,0,0,!t),t)},r.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},r}(),dn=function(){function r(e,t){Me([Se,function(){return[ee,ae]}],this,St.call(this,e,t),function(n){var i=new ae(n.data);onmessage=ee(i)},6)}return r}();function wn(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[Se],function(n){return ve(Xe(n.data[0],n.data[1]))},0,t)}function Xe(r,e){return ge(r,e||{},0,0)}var $=function(){function r(e){this.s={},this.p=new S(0),this.ondata=e}return r.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new S(t+e.length);n.set(this.p),n.set(e,t),this.p=n},r.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ve(this.p,this.o,this.s);this.ondata(_(n,t,this.s.b),this.d),this.o=_(n,this.s.b-32768),this.s.b=this.o.length,this.p=_(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(e,t){this.e(e),this.c(t)},r}(),Ct=function(){function r(e){this.ondata=e,Me([De,function(){return[ee,$]}],this,0,function(){var t=new $;onmessage=ee(t)},7)}return r}();function Mt(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[De],function(n){return ve(Ee(n.data[0],It(n.data[1])))},1,t)}function Ee(r,e){return Ve(r,e)}var et=function(){function r(e,t){this.c=Pe(),this.l=0,this.v=1,ae.call(this,e,t)}return r.prototype.push=function(e,t){ae.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=ge(e,this.o,this.v&&Pt(this.o),t&&8,!t);this.v&&(At(n,this.o),this.v=0),t&&(C(n,n.length-8,this.c.d()),C(n,n.length-4,this.l)),this.ondata(n,t)},r}(),Kt=function(){function r(e,t){Me([Se,hn,function(){return[ee,ae,et]}],this,St.call(this,e,t),function(n){var i=new et(n.data);onmessage=ee(i)},8)}return r}();function Wt(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[Se,hn,function(){return[tt]}],function(n){return ve(tt(n.data[0],n.data[1]))},2,t)}function tt(r,e){e||(e={});var t=Pe(),n=r.length;t.p(r);var i=ge(r,e,Pt(e),8),a=i.length;return At(i,e),C(i,a-8,t.d()),C(i,a-4,n),i}var nt=function(){function r(e){this.v=1,$.call(this,e)}return r.prototype.push=function(e,t){if($.prototype.e.call(this,e),this.v){var n=this.p.length>3?Ft(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$.prototype.c.call(this,t)},r}(),Tn=function(){function r(e){this.ondata=e,Me([De,pn,function(){return[ee,$,nt]}],this,0,function(){var t=new nt;onmessage=ee(t)},9)}return r}();function xn(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[De,pn,function(){return[rt]}],function(n){return ve(rt(n.data[0]))},3,t)}function rt(r,e){return Ve(r.subarray(Ft(r),-8),e||new S(mn(r)))}var mt=function(){function r(e,t){this.c=xt(),this.v=1,ae.call(this,e,t)}return r.prototype.push=function(e,t){ae.prototype.push.call(this,e,t)},r.prototype.p=function(e,t){this.c.p(e);var n=ge(e,this.o,this.v&&2,t&&4,!t);this.v&&(Dt(n,this.o),this.v=0),t&&C(n,n.length-4,this.c.d()),this.ondata(n,t)},r}(),vr=function(){function r(e,t){Me([Se,vn,function(){return[ee,ae,mt]}],this,St.call(this,e,t),function(n){var i=new mt(n.data);onmessage=ee(i)},10)}return r}();function gr(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[Se,vn,function(){return[yt]}],function(n){return ve(yt(n.data[0],n.data[1]))},4,t)}function yt(r,e){e||(e={});var t=xt();t.p(r);var n=ge(r,e,2,4);return Dt(n,e),C(n,n.length-4,t.d()),n}var it=function(){function r(e){this.v=1,$.call(this,e)}return r.prototype.push=function(e,t){if($.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$.prototype.c.call(this,t)},r}(),In=function(){function r(e){this.ondata=e,Me([De,gn,function(){return[ee,$,it]}],this,0,function(){var t=new it;onmessage=ee(t)},11)}return r}();function An(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ce(r,e,[De,gn,function(){return[Ue]}],function(n){return ve(Ue(n.data[0],It(n.data[1])))},5,t)}function Ue(r,e){return Ve((yn(r),r.subarray(2,-4)),e)}var Fn=function(){function r(e){this.G=nt,this.I=$,this.Z=it,this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new S(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,a=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(a):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(a):new this.Z(a),this.s.push(this.p,t),this.p=null}}},r}(),mr=function(){function r(e){this.G=Tn,this.I=Ct,this.Z=In,this.ondata=e}return r.prototype.push=function(e,t){Fn.prototype.push.call(this,e,t)},r}();function yr(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return r[0]==31&&r[1]==139&&r[2]==8?xn(r,e,t):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Mt(r,e,t):An(r,e,t)}function dr(r,e){return r[0]==31&&r[1]==139&&r[2]==8?rt(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?Ee(r,e):Ue(r,e)}var Et=function(r,e,t,n){for(var i in r){var a=r[i],s=e+i;a instanceof S?t[s]=[a,n]:Array.isArray(a)?t[s]=[a[0],je(n,a[1])]:Et(a,s+"/",t,n)}},qt=typeof TextEncoder!="undefined"&&new TextEncoder,dt=typeof TextDecoder!="undefined"&&new TextDecoder,Pn=0;try{dt.decode(se,{stream:!0}),Pn=1}catch{}var Dn=function(r){for(var e="",t=0;;){var n=r[t++],i=(n>127)+(n>223)+(n>239);if(t+i>r.length)return[e,_(r,t-1)];i?i==3?(n=((n&15)<<18|(r[t++]&63)<<12|(r[t++]&63)<<6|r[t++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?e+=String.fromCharCode((n&31)<<6|r[t++]&63):e+=String.fromCharCode((n&15)<<12|(r[t++]&63)<<6|r[t++]&63):e+=String.fromCharCode(n)}},wr=function(){function r(e){this.ondata=e,Pn?this.t=new TextDecoder:this.p=se}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var n=new S(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var i=Dn(n),a=i[0],s=i[1];if(t){if(s.length)throw"invalid utf-8 data";this.p=null}else this.p=s;this.ondata(a,t)},r}(),Tr=function(){function r(e){this.ondata=e}return r.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(pe(e),this.d=t||!1)},r}();function pe(r,e){if(e){for(var t=new S(r.length),n=0;n<r.length;++n)t[n]=r.charCodeAt(n);return t}if(qt)return qt.encode(r);for(var i=r.length,a=new S(r.length+(r.length>>1)),s=0,o=function(f){a[s++]=f},n=0;n<i;++n){if(s+5>a.length){var l=new S(s+8+(i-n<<1));l.set(a),a=l}var c=r.charCodeAt(n);c<128||e?o(c):c<2048?(o(192|c>>6),o(128|c&63)):c>55295&&c<57344?(c=65536+(c&1023<<10)|r.charCodeAt(++n)&1023,o(240|c>>18),o(128|c>>12&63),o(128|c>>6&63),o(128|c&63)):(o(224|c>>12),o(128|c>>6&63),o(128|c&63))}return _(a,0,s)}function Lt(r,e){if(e){for(var t="",n=0;n<r.length;n+=16384)t+=String.fromCharCode.apply(null,r.subarray(n,n+16384));return t}else{if(dt)return dt.decode(r);var i=Dn(r),a=i[0],s=i[1];if(s.length)throw"invalid utf-8 data";return a}}var Sn=function(r){return r==1?3:r<6?2:r==9?1:0},Cn=function(r,e){return e+30+K(r,e+26)+K(r,e+28)},Mn=function(r,e,t){var n=K(r,e+28),i=Lt(r.subarray(e+46,e+46+n),!(K(r,e+8)&2048)),a=e+46+n,s=b(r,e+20),o=t&&s==4294967295?En(r,a):[s,b(r,e+24),b(r,e+42)],l=o[0],c=o[1],f=o[2];return[K(r,e+10),l,c,i,a+K(r,e+30)+K(r,e+32),f]},En=function(r,e){for(;K(r,e)!=1;e+=4+K(r,e+2));return[ct(r,e+12),ct(r,e+4),ct(r,e+20)]},fe=function(r){var e=0;if(r)for(var t in r){var n=r[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Ie=function(r,e,t,n,i,a,s,o){var l=n.length,c=t.extra,f=o&&o.length,u=fe(c);C(r,e,s!=null?33639248:67324752),e+=4,s!=null&&(r[e++]=20,r[e++]=t.os),r[e]=20,e+=2,r[e++]=t.flag<<1|(a==null&&8),r[e++]=i&&8,r[e++]=t.compression&255,r[e++]=t.compression>>8;var h=new Date(t.mtime==null?Date.now():t.mtime),p=h.getFullYear()-1980;if(p<0||p>119)throw"date not in range 1980-2099";if(C(r,e,p<<25|h.getMonth()+1<<21|h.getDate()<<16|h.getHours()<<11|h.getMinutes()<<5|h.getSeconds()>>>1),e+=4,a!=null&&(C(r,e,t.crc),C(r,e+4,a),C(r,e+8,t.size)),C(r,e+12,l),C(r,e+14,u),e+=16,s!=null&&(C(r,e,f),C(r,e+6,t.attrs),C(r,e+10,s),e+=14),r.set(n,e),e+=l,u)for(var v in c){var g=c[v],y=g.length;C(r,e,+v),C(r,e+2,y),r.set(g,e+4),e+=4+y}return f&&(r.set(o,e),e+=f),e},kt=function(r,e,t,n,i){C(r,e,101010256),C(r,e+8,t),C(r,e+10,t),C(r,e+12,n),C(r,e+16,i)},Ge=function(){function r(e){this.filename=e,this.c=Pe(),this.size=0,this.compression=0}return r.prototype.process=function(e,t){this.ondata(null,e,t)},r.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},r}(),xr=function(){function r(e,t){var n=this;t||(t={}),Ge.call(this,e),this.d=new ae(t,function(i,a){n.ondata(null,i,a)}),this.compression=8,this.flag=Sn(t.level)}return r.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},r.prototype.push=function(e,t){Ge.prototype.push.call(this,e,t)},r}(),Ir=function(){function r(e,t){var n=this;t||(t={}),Ge.call(this,e),this.d=new dn(t,function(i,a,s){n.ondata(i,a,s)}),this.compression=8,this.flag=Sn(t.level),this.terminate=this.d.terminate}return r.prototype.process=function(e,t){this.d.push(e,t)},r.prototype.push=function(e,t){Ge.prototype.push.call(this,e,t)},r}(),Ar=function(){function r(e){this.ondata=e,this.u=[],this.d=1}return r.prototype.add=function(e){var t=this;if(this.d&2)throw"stream finished";var n=pe(e.filename),i=n.length,a=e.comment,s=a&&pe(a),o=i!=e.filename.length||s&&a.length!=s.length,l=i+fe(e.extra)+30;if(i>65535)throw"filename too long";var c=new S(l);Ie(c,0,e,n,o);var f=[c],u=function(){for(var y=0,T=f;y<T.length;y++){var w=T[y];t.ondata(null,w,!1)}f=[]},h=this.d;this.d=0;var p=this.u.length,v=je(e,{f:n,u:o,o:s,t:function(){e.terminate&&e.terminate()},r:function(){if(u(),h){var y=t.u[p+1];y?y.r():t.d=1}h=1}}),g=0;e.ondata=function(y,T,w){if(y)t.ondata(y,T,w),t.terminate();else if(g+=T.length,f.push(T),w){var m=new S(16);C(m,0,134695760),C(m,4,e.crc),C(m,8,g),C(m,12,e.size),f.push(m),v.c=g,v.b=l+g+16,v.crc=e.crc,v.size=e.size,h&&v.r(),h=1}else h&&u()},this.u.push(v)},r.prototype.end=function(){var e=this;if(this.d&2)throw this.d&1?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){!(e.d&1)||(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},r.prototype.e=function(){for(var e=0,t=0,n=0,i=0,a=this.u;i<a.length;i++){var s=a[i];n+=46+s.f.length+fe(s.extra)+(s.o?s.o.length:0)}for(var o=new S(n+22),l=0,c=this.u;l<c.length;l++){var s=c[l];Ie(o,e,s,s.f,s.u,s.c,t,s.o),e+=46+s.f.length+fe(s.extra)+(s.o?s.o.length:0),t+=s.b}kt(o,e,this.u.length,n,t),this.ondata(null,o,!0),this.d=2},r.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){var n=t[e];n.t()}this.d=2},r}();function Fr(r,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Et(r,"",n,e);var i=Object.keys(n),a=i.length,s=0,o=0,l=a,c=new Array(a),f=[],u=function(){for(var g=0;g<f.length;++g)f[g]()},h=function(){var g=new S(o+22),y=s,T=o-s;o=0;for(var w=0;w<l;++w){var m=c[w];try{var x=m.c.length;Ie(g,o,m,m.f,m.u,x);var P=30+m.f.length+fe(m.extra),A=o+P;g.set(m.c,A),Ie(g,s,m,m.f,m.u,x,o,m.m),s+=16+P+(m.m?m.m.length:0),o=A+x}catch(I){return t(I,null)}}kt(g,s,c.length,T,y),t(null,g)};a||h();for(var p=function(g){var y=i[g],T=n[y],w=T[0],m=T[1],x=Pe(),P=w.length;x.p(w);var A=pe(y),I=A.length,d=m.comment,R=d&&pe(d),F=R&&R.length,j=fe(m.extra),L=m.level==0?0:8,M=function(E,O){if(E)u(),t(E,null);else{var k=O.length;c[g]=je(m,{size:P,crc:x.d(),c:O,f:A,m:R,u:I!=y.length||R&&d.length!=F,compression:L}),s+=30+I+j+k,o+=76+2*(I+j)+(F||0)+k,--a||h()}};if(I>65535&&M("filename too long",null),!L)M(null,w);else if(P<16e4)try{M(null,Xe(w,m))}catch(E){M(E,null)}else f.push(wn(w,m,M))},v=0;v<l;++v)p(v);return u}function Pr(r,e){e||(e={});var t={},n=[];Et(r,"",t,e);var i=0,a=0;for(var s in t){var o=t[s],l=o[0],c=o[1],f=c.level==0?0:8,u=pe(s),h=u.length,p=c.comment,v=p&&pe(p),g=v&&v.length,y=fe(c.extra);if(h>65535)throw"filename too long";var T=f?Xe(l,c):l,w=T.length,m=Pe();m.p(l),n.push(je(c,{size:l.length,crc:m.d(),c:T,f:u,m:v,u:h!=s.length||v&&p.length!=g,o:i,compression:f})),i+=30+h+y+w,a+=76+2*(h+y)+(g||0)+w}for(var x=new S(a+22),P=i,A=a-i,I=0;I<n.length;++I){var u=n[I];Ie(x,u.o,u,u.f,u.u,u.c.length);var d=30+u.f.length+fe(u.extra);x.set(u.c,u.o+d),Ie(x,i,u,u.f,u.u,u.c.length,u.o,u.m),i+=16+d+(u.m?u.m.length:0)}return kt(x,i,n.length,A,P),x}var Ln=function(){function r(){}return r.prototype.push=function(e,t){this.ondata(null,e,t)},r.compression=0,r}(),Dr=function(){function r(){var e=this;this.i=new $(function(t,n){e.ondata(null,t,n)})}return r.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},r.compression=8,r}(),Sr=function(){function r(e,t){var n=this;t<32e4?this.i=new $(function(i,a){n.ondata(null,i,a)}):(this.i=new Ct(function(i,a,s){n.ondata(i,a,s)}),this.terminate=this.i.terminate)}return r.prototype.push=function(e,t){this.i.terminate&&(e=_(e,0)),this.i.push(e,t)},r.compression=8,r}(),Cr=function(){function r(e){this.onfile=e,this.k=[],this.o={0:Ln},this.p=se}return r.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),a=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(a,!this.c):this.k[0].push(a),e=e.subarray(i),e.length)return this.push(e,t)}else{var s=0,o=0,l=void 0,c=void 0;this.p.length?e.length?(c=new S(this.p.length+e.length),c.set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var f=c.length,u=this.c,h=u&&this.d,p=function(){var T,w=b(c,o);if(w==67324752){s=1,l=o,v.d=null,v.c=0;var m=K(c,o+6),x=K(c,o+8),P=m&2048,A=m&8,I=K(c,o+26),d=K(c,o+28);if(f>o+30+I+d){var R=[];v.k.unshift(R),s=2;var F=b(c,o+18),j=b(c,o+22),L=Lt(c.subarray(o+30,o+=30+I),!P);F==4294967295?(T=A?[-2]:En(c,o),F=T[0],j=T[1]):A&&(F=-1),o+=d,v.c=F;var M,E={name:L,compression:x,start:function(){if(!E.ondata)throw"no callback";if(!F)E.ondata(null,se,!0);else{var O=n.o[x];if(!O)throw"unknown compression type "+x;M=F<0?new O(L):new O(L,F,j),M.ondata=function(W,Q,H){E.ondata(W,Q,H)};for(var k=0,B=R;k<B.length;k++){var Z=B[k];M.push(Z,!1)}n.k[0]==R&&n.c?n.d=M:M.push(se,!0)}},terminate:function(){M&&M.terminate&&M.terminate()}};F>=0&&(E.size=F,E.originalSize=j),v.onfile(E)}return"break"}else if(u){if(w==134695760)return l=o+=12+(u==-2&&8),s=3,v.c=0,"break";if(w==33639248)return l=o-=4,s=3,v.c=0,"break"}},v=this;o<f-4;++o){var g=p();if(g==="break")break}if(this.p=se,u<0){var y=s?c.subarray(0,l-12-(u==-2&&8)-(b(c,l-16)==134695760&&4)):c.subarray(0,o);h?h.push(y,!!s):this.k[+(s==2)].push(y)}if(s&2)return this.push(c.subarray(o),t);this.p=c.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},r.prototype.register=function(e){this.o[e.compression]=e},r}();function Mr(r,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var h=0;h<t.length;++h)t[h]()},i={},a=r.length-22;b(r,a)!=101010256;--a)if(!a||r.length-a>65558){e("invalid zip file",null);return}var s=K(r,a+8);s||e(null,{});var o=s,l=b(r,a+16),c=l==4294967295;if(c){if(a=b(r,a-12),b(r,a)!=101075792){e("invalid zip file",null);return}o=s=b(r,a+32),l=b(r,a+48)}for(var f=function(h){var p=Mn(r,l,c),v=p[0],g=p[1],y=p[2],T=p[3],w=p[4],m=p[5],x=Cn(r,m);l=w;var P=function(I,d){I?(n(),e(I,null)):(i[T]=d,--s||e(null,i))};if(!v)P(null,_(r,x,x+g));else if(v==8){var A=r.subarray(x,x+g);if(g<32e4)try{P(null,Ee(A,new S(y)))}catch(I){P(I,null)}else t.push(Mt(A,{size:y},P))}else P("unknown compression type "+v,null)},u=0;u<o;++u)f();return n}function Er(r){for(var e={},t=r.length-22;b(r,t)!=101010256;--t)if(!t||r.length-t>65558)throw"invalid zip file";var n=K(r,t+8);if(!n)return{};var i=b(r,t+16),a=i==4294967295;if(a){if(t=b(r,t-12),b(r,t)!=101075792)throw"invalid zip file";n=b(r,t+32),i=b(r,t+48)}for(var s=0;s<n;++s){var o=Mn(r,i,a),l=o[0],c=o[1],f=o[2],u=o[3],h=o[4],p=o[5],v=Cn(r,p);if(i=h,!l)e[u]=_(r,v,v+c);else if(l==8)e[u]=Ee(r.subarray(v,v+c),new S(f));else throw"unknown compression type "+l}return e}var Lr=Object.freeze(Object.defineProperty({__proto__:null,Deflate:ae,AsyncDeflate:dn,deflate:wn,deflateSync:Xe,Inflate:$,AsyncInflate:Ct,inflate:Mt,inflateSync:Ee,Gzip:et,AsyncGzip:Kt,gzip:Wt,gzipSync:tt,Gunzip:nt,AsyncGunzip:Tn,gunzip:xn,gunzipSync:rt,Zlib:mt,AsyncZlib:vr,zlib:gr,zlibSync:yt,Unzlib:it,AsyncUnzlib:In,unzlib:An,unzlibSync:Ue,compress:Wt,AsyncCompress:Kt,compressSync:tt,Compress:et,Decompress:Fn,AsyncDecompress:mr,decompress:yr,decompressSync:dr,DecodeUTF8:wr,EncodeUTF8:Tr,strToU8:pe,strFromU8:Lt,ZipPassThrough:Ge,ZipDeflate:xr,AsyncZipDeflate:Ir,Zip:Ar,zip:Fr,zipSync:Pr,UnzipPassThrough:Ln,UnzipInflate:Dr,AsyncUnzipInflate:Sr,Unzip:Cr,unzip:Mr,unzipSync:Er},Symbol.toStringTag,{value:"Module"}));function kn(r,e,t){const n=t.length-r-1;if(e>=t[n])return n-1;if(e<=t[r])return r;let i=r,a=n,s=Math.floor((i+a)/2);for(;e<t[s]||e>=t[s+1];)e<t[s]?a=s:i=s,s=Math.floor((i+a)/2);return s}function kr(r,e,t,n){const i=[],a=[],s=[];i[0]=1;for(let o=1;o<=t;++o){a[o]=e-n[r+1-o],s[o]=n[r+o]-e;let l=0;for(let c=0;c<o;++c){const f=s[c+1],u=a[o-c],h=i[c]/(f+u);i[c]=l+f*h,l=u*h}i[o]=l}return i}function zr(r,e,t,n){const i=kn(r,n,e),a=kr(i,n,r,e),s=new at(0,0,0,0);for(let o=0;o<=r;++o){const l=t[i-r+o],c=a[o],f=l.w*c;s.x+=l.x*f,s.y+=l.y*f,s.z+=l.z*f,s.w+=l.w*c}return s}function Rr(r,e,t,n,i){const a=[];for(let u=0;u<=t;++u)a[u]=0;const s=[];for(let u=0;u<=n;++u)s[u]=a.slice(0);const o=[];for(let u=0;u<=t;++u)o[u]=a.slice(0);o[0][0]=1;const l=a.slice(0),c=a.slice(0);for(let u=1;u<=t;++u){l[u]=e-i[r+1-u],c[u]=i[r+u]-e;let h=0;for(let p=0;p<u;++p){const v=c[p+1],g=l[u-p];o[u][p]=v+g;const y=o[p][u-1]/o[u][p];o[p][u]=h+v*y,h=g*y}o[u][u]=h}for(let u=0;u<=t;++u)s[0][u]=o[u][t];for(let u=0;u<=t;++u){let h=0,p=1;const v=[];for(let g=0;g<=t;++g)v[g]=a.slice(0);v[0][0]=1;for(let g=1;g<=n;++g){let y=0;const T=u-g,w=t-g;u>=g&&(v[p][0]=v[h][0]/o[w+1][T],y=v[p][0]*o[T][w]);const m=T>=-1?1:-T,x=u-1<=w?g-1:t-u;for(let A=m;A<=x;++A)v[p][A]=(v[h][A]-v[h][A-1])/o[w+1][T+A],y+=v[p][A]*o[T+A][w];u<=w&&(v[p][g]=-v[h][g-1]/o[w+1][u],y+=v[p][g]*o[u][w]),s[g][u]=y;const P=h;h=p,p=P}}let f=t;for(let u=1;u<=n;++u){for(let h=0;h<=t;++h)s[u][h]*=f;f*=t-u}return s}function Br(r,e,t,n,i){const a=i<r?i:r,s=[],o=kn(r,n,e),l=Rr(o,n,r,a,e),c=[];for(let f=0;f<t.length;++f){const u=t[f].clone(),h=u.w;u.x*=h,u.y*=h,u.z*=h,c[f]=u}for(let f=0;f<=a;++f){const u=c[o-r].clone().multiplyScalar(l[f][0]);for(let h=1;h<=r;++h)u.add(c[o-r+h].clone().multiplyScalar(l[f][h]));s[f]=u}for(let f=a+1;f<=i+1;++f)s[f]=new at(0,0,0);return s}function Or(r,e){let t=1;for(let i=2;i<=r;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=r-e;++i)n*=i;return t/n}function Ur(r){const e=r.length,t=[],n=[];for(let a=0;a<e;++a){const s=r[a];t[a]=new he(s.x,s.y,s.z),n[a]=s.w}const i=[];for(let a=0;a<e;++a){const s=t[a].clone();for(let o=1;o<=a;++o)s.sub(i[a-o].clone().multiplyScalar(Or(a,o)*n[o]));i[a]=s.divideScalar(n[0])}return i}function Gr(r,e,t,n,i){const a=Br(r,e,t,n,i);return Ur(a)}class Yt extends Gn{constructor(e,t,n,i,a){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=a||this.knots.length-1;for(let s=0;s<n.length;++s){const o=n[s];this.controlPoints[s]=new at(o.x,o.y,o.z,o.w)}}getPoint(e,t=new he){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),a=zr(this.degree,this.knots,this.controlPoints,i);return a.w!==1&&a.divideScalar(a.w),n.set(a.x,a.y,a.z)}getTangent(e,t=new he){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),a=Gr(this.degree,this.knots,this.controlPoints,i,1);return n.copy(a[1]).normalize(),n}}let D,G,Y;class br extends bn{constructor(e){super(e)}load(e,t,n,i){const a=this,s=a.path===""?wt.extractUrlBase(e):a.path,o=new Vn(this.manager);o.setPath(a.path),o.setResponseType("arraybuffer"),o.setRequestHeader(a.requestHeader),o.setWithCredentials(a.withCredentials),o.load(e,function(l){try{t(a.parse(l,s))}catch(c){i?i(c):console.error(c),a.manager.itemError(e)}},n,i)}parse(e,t){if(Kr(e))D=new Hr().parse(e);else{const i=On(e);if(!Wr(i))throw new Error("THREE.FBXLoader: Unknown format.");if(Qt(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Qt(i));D=new Zr().parse(i)}const n=new jn(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new Vr(n,this.manager).parse(D)}}class Vr{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){G=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),a=new jr().parse(i);return this.parseScene(i,a,n),Y}parseConnections(){const e=new Map;return"Connections"in D&&D.Connections.connections.forEach(function(n){const i=n[0],a=n[1],s=n[2];e.has(i)||e.set(i,{parents:[],children:[]});const o={ID:a,relationship:s};e.get(i).parents.push(o),e.has(a)||e.set(a,{parents:[],children:[]});const l={ID:i,relationship:s};e.get(a).children.push(l)}),e}parseImages(){const e={},t={};if("Video"in D.Objects){const n=D.Objects.Video;for(const i in n){const a=n[i],s=parseInt(i);if(e[s]=a.RelativeFilename||a.Filename,"Content"in a){const o=a.Content instanceof ArrayBuffer&&a.Content.byteLength>0,l=typeof a.Content=="string"&&a.Content!=="";if(o||l){const c=this.parseImage(n[i]);t[a.RelativeFilename||a.Filename]=c}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let a;switch(i){case"bmp":a="image/bmp";break;case"jpg":case"jpeg":a="image/jpeg";break;case"png":a="image/png";break;case"tif":a="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),a="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+a+";base64,"+t;{const s=new Uint8Array(t);return window.URL.createObjectURL(new Blob([s],{type:a}))}}parseTextures(e){const t=new Map;if("Texture"in D.Objects){const n=D.Objects.Texture;for(const i in n){const a=this.parseTexture(n[i],e);t.set(parseInt(i),a)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,a=e.WrapModeV,s=i!==void 0?i.value:0,o=a!==void 0?a.value:0;if(n.wrapS=s===0?Ot:Ut,n.wrapT=o===0?Ot:Ut,"Scaling"in e){const l=e.Scaling.value;n.repeat.x=l[0],n.repeat.y=l[1]}if("Translation"in e){const l=e.Translation.value;n.offset.x=l[0],n.offset.y=l[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,a=G.get(e.id).children;a!==void 0&&a.length>0&&t[a[0].ID]!==void 0&&(n=t[a[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let s;const o=e.FileName.slice(-3).toLowerCase();if(o==="tga"){const l=this.manager.getHandler(".tga");l===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),s=new Gt):(l.setPath(this.textureLoader.path),s=l.load(n))}else o==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),s=new Gt):s=this.textureLoader.load(n);return this.textureLoader.setPath(i),s}parseMaterials(e){const t=new Map;if("Material"in D.Objects){const n=D.Objects.Material;for(const i in n){const a=this.parseMaterial(n[i],e);a!==null&&t.set(parseInt(i),a)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let a=e.ShadingModel;if(typeof a=="object"&&(a=a.value),!G.has(n))return null;const s=this.parseParameters(e,t,n);let o;switch(a.toLowerCase()){case"phong":o=new ot;break;case"lambert":o=new Xn;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),o=new ot;break}return o.setValues(s),o.name=i,o}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new ce().fromArray(e.Diffuse.value):e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new ce().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new ce().fromArray(e.Emissive.value):e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new ce().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new ce().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new ce().fromArray(e.SpecularColor.value));const a=this;return G.get(n).children.forEach(function(s){const o=s.relationship;switch(o){case"Bump":i.bumpMap=a.getTexture(t,s.ID);break;case"Maya|TEX_ao_map":i.aoMap=a.getTexture(t,s.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=a.getTexture(t,s.ID),i.map!==void 0&&(i.map.encoding=ke);break;case"DisplacementColor":i.displacementMap=a.getTexture(t,s.ID);break;case"EmissiveColor":i.emissiveMap=a.getTexture(t,s.ID),i.emissiveMap!==void 0&&(i.emissiveMap.encoding=ke);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=a.getTexture(t,s.ID);break;case"ReflectionColor":i.envMap=a.getTexture(t,s.ID),i.envMap!==void 0&&(i.envMap.mapping=Zn,i.envMap.encoding=ke);break;case"SpecularColor":i.specularMap=a.getTexture(t,s.ID),i.specularMap!==void 0&&(i.specularMap.encoding=ke);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=a.getTexture(t,s.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",o);break}}),i}getTexture(e,t){return"LayeredTexture"in D.Objects&&t in D.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=G.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in D.Objects){const n=D.Objects.Deformer;for(const i in n){const a=n[i],s=G.get(parseInt(i));if(a.attrType==="Skin"){const o=this.parseSkeleton(s,n);o.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=s.parents[0].ID,e[i]=o}else if(a.attrType==="BlendShape"){const o={id:i};o.rawTargets=this.parseMorphTargets(s,n),o.id=i,s.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=o}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const a=t[i.ID];if(a.attrType!=="Cluster")return;const s={ID:i.ID,indices:[],weights:[],transformLink:new U().fromArray(a.TransformLink.a)};"Indexes"in a&&(s.indices=a.Indexes.a,s.weights=a.Weights.a),n.push(s)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const a=e.children[i],s=t[a.ID],o={name:s.attrName,initialWeight:s.DeformPercent,id:s.id,fullWeights:s.FullWeights.a};if(s.attrType!=="BlendShapeChannel")return;o.geoID=G.get(parseInt(a.ID)).children.filter(function(l){return l.relationship===void 0})[0].ID,n.push(o)}return n}parseScene(e,t,n){Y=new bt;const i=this.parseModels(e.skeletons,t,n),a=D.Objects.Model,s=this;i.forEach(function(l){const c=a[l.ID];s.setLookAtProperties(l,c),G.get(l.ID).parents.forEach(function(u){const h=i.get(u.ID);h!==void 0&&h.add(l)}),l.parent===null&&Y.add(l)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),Y.traverse(function(l){if(l.userData.transformData){l.parent&&(l.userData.transformData.parentMatrix=l.parent.matrix,l.userData.transformData.parentMatrixWorld=l.parent.matrixWorld);const c=Rn(l.userData.transformData);l.applyMatrix4(c),l.updateWorldMatrix()}});const o=new Xr().parse();Y.children.length===1&&Y.children[0].isGroup&&(Y.children[0].animations=o,Y=Y.children[0]),Y.animations=o}parseModels(e,t,n){const i=new Map,a=D.Objects.Model;for(const s in a){const o=parseInt(s),l=a[s],c=G.get(o);let f=this.buildSkeleton(c,e,o,l.attrName);if(!f){switch(l.attrType){case"Camera":f=this.createCamera(c);break;case"Light":f=this.createLight(c);break;case"Mesh":f=this.createMesh(c,t,n);break;case"NurbsCurve":f=this.createCurve(c,t);break;case"LimbNode":case"Root":f=new Vt;break;case"Null":default:f=new bt;break}f.name=l.attrName?Je.sanitizeNodeName(l.attrName):"",f.ID=o}this.getTransformData(f,l),i.set(o,f)}return i}buildSkeleton(e,t,n,i){let a=null;return e.parents.forEach(function(s){for(const o in t){const l=t[o];l.rawBones.forEach(function(c,f){if(c.ID===s.ID){const u=a;a=new Vt,a.matrixWorld.copy(c.transformLink),a.name=i?Je.sanitizeNodeName(i):"",a.ID=n,l.bones[f]=a,u!==null&&a.add(u)}})}}),a}createCamera(e){let t,n;if(e.children.forEach(function(i){const a=D.Objects.NodeAttribute[i.ID];a!==void 0&&(n=a)}),n===void 0)t=new lt;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let a=1;n.NearPlane!==void 0&&(a=n.NearPlane.value/1e3);let s=1e3;n.FarPlane!==void 0&&(s=n.FarPlane.value/1e3);let o=window.innerWidth,l=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(o=n.AspectWidth.value,l=n.AspectHeight.value);const c=o/l;let f=45;n.FieldOfView!==void 0&&(f=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new Kn(f,c,a,s),u!==null&&t.setFocalLength(u);break;case 1:t=new Hn(-o/2,o/2,l/2,-l/2,a,s);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new lt;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const a=D.Objects.NodeAttribute[i.ID];a!==void 0&&(n=a)}),n===void 0)t=new lt;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let a=16777215;n.Color!==void 0&&(a=new ce().fromArray(n.Color.value));let s=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(s=0);let o=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?o=0:o=n.FarAttenuationEnd.value);const l=1;switch(i){case 0:t=new jt(a,s,o,l);break;case 1:t=new qn(a,s);break;case 2:let c=Math.PI/3;n.InnerAngle!==void 0&&(c=ie.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=ie.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new Wn(a,s,o,c,f,l);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new jt(a,s);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,a=null,s=null;const o=[];return e.children.forEach(function(l){t.has(l.ID)&&(a=t.get(l.ID)),n.has(l.ID)&&o.push(n.get(l.ID))}),o.length>1?s=o:o.length>0?s=o[0]:(s=new ot({color:13421772}),o.push(s)),"color"in a.attributes&&o.forEach(function(l){l.vertexColors=!0}),a.FBX_Deformer?(i=new Yn(a,s),i.normalizeSkinWeights()):i=new $n(a,s),i}createCurve(e,t){const n=e.children.reduce(function(a,s){return t.has(s.ID)&&(a=t.get(s.ID)),a},null),i=new Qn({color:3342591,linewidth:1});return new Jn(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=Bn(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&G.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const a=D.Objects.Model[i.ID];if("Lcl_Translation"in a){const s=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(s),Y.add(e.target)):e.lookAt(new he().fromArray(s))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const a in e){const s=e[a];G.get(parseInt(s.ID)).parents.forEach(function(l){if(t.has(l.ID)){const c=l.ID;G.get(c).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new Nn(s.bones),i[u.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in D.Objects){const t=D.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(a){e[a.Node]=new U().fromArray(a.Matrix.a)}):e[i.Node]=new U().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in D&&"AmbientColor"in D.GlobalSettings){const e=D.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const a=new ce(t,n,i);Y.add(new _n(a,1))}}}}class jr{parse(e){const t=new Map;if("Geometry"in D.Objects){const n=D.Objects.Geometry;for(const i in n){const a=G.get(parseInt(i)),s=this.parseGeometry(a,n[i],e);t.set(parseInt(i),s)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,a=[],s=e.parents.map(function(u){return D.Objects.Model[u.ID]});if(s.length===0)return;const o=e.children.reduce(function(u,h){return i[h.ID]!==void 0&&(u=i[h.ID]),u},null);e.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&a.push(n.morphTargets[u.ID])});const l=s[0],c={};"RotationOrder"in l&&(c.eulerOrder=Bn(l.RotationOrder.value)),"InheritType"in l&&(c.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(c.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(c.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(c.scale=l.GeometricScaling.value);const f=Rn(c);return this.genGeometry(t,o,a,f)}genGeometry(e,t,n,i){const a=new He;e.attrName&&(a.name=e.attrName);const s=this.parseGeoNode(e,t),o=this.genBuffers(s),l=new ye(o.vertex,3);if(l.applyMatrix4(i),a.setAttribute("position",l),o.colors.length>0&&a.setAttribute("color",new ye(o.colors,3)),t&&(a.setAttribute("skinIndex",new er(o.weightsIndices,4)),a.setAttribute("skinWeight",new ye(o.vertexWeights,4)),a.FBX_Deformer=t),o.normal.length>0){const c=new tr().getNormalMatrix(i),f=new ye(o.normal,3);f.applyNormalMatrix(c),a.setAttribute("normal",f)}if(o.uvs.forEach(function(c,f){let u="uv"+(f+1).toString();f===0&&(u="uv"),a.setAttribute(u,new ye(o.uvs[f],2))}),s.material&&s.material.mappingType!=="AllSame"){let c=o.materialIndex[0],f=0;if(o.materialIndex.forEach(function(u,h){u!==c&&(a.addGroup(f,h-f,c),c=u,f=h)}),a.groups.length>0){const u=a.groups[a.groups.length-1],h=u.start+u.count;h!==o.materialIndex.length&&a.addGroup(h,o.materialIndex.length-h,c)}a.groups.length===0&&a.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(a,e,n,i),a}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,a){i.indices.forEach(function(s,o){n.weightTable[s]===void 0&&(n.weightTable[s]=[]),n.weightTable[s].push({id:a,weight:i.weights[o]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,a=!1,s=[],o=[],l=[],c=[],f=[],u=[];const h=this;return e.vertexIndices.forEach(function(p,v){let g,y=!1;p<0&&(p=p^-1,y=!0);let T=[],w=[];if(s.push(p*3,p*3+1,p*3+2),e.color){const m=qe(v,n,p,e.color);l.push(m[0],m[1],m[2])}if(e.skeleton){if(e.weightTable[p]!==void 0&&e.weightTable[p].forEach(function(m){w.push(m.weight),T.push(m.id)}),w.length>4){a||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),a=!0);const m=[0,0,0,0],x=[0,0,0,0];w.forEach(function(P,A){let I=P,d=T[A];x.forEach(function(R,F,j){if(I>R){j[F]=I,I=R;const L=m[F];m[F]=d,d=L}})}),T=m,w=x}for(;w.length<4;)w.push(0),T.push(0);for(let m=0;m<4;++m)f.push(w[m]),u.push(T[m])}if(e.normal){const m=qe(v,n,p,e.normal);o.push(m[0],m[1],m[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=qe(v,n,p,e.material)[0]),e.uv&&e.uv.forEach(function(m,x){const P=qe(v,n,p,m);c[x]===void 0&&(c[x]=[]),c[x].push(P[0]),c[x].push(P[1])}),i++,y&&(h.genFace(t,e,s,g,o,l,c,f,u,i),n++,i=0,s=[],o=[],l=[],c=[],f=[],u=[])}),t}genFace(e,t,n,i,a,s,o,l,c,f){for(let u=2;u<f;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[(u-1)*3]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+1]]),e.vertex.push(t.vertexPositions[n[(u-1)*3+2]]),e.vertex.push(t.vertexPositions[n[u*3]]),e.vertex.push(t.vertexPositions[n[u*3+1]]),e.vertex.push(t.vertexPositions[n[u*3+2]]),t.skeleton&&(e.vertexWeights.push(l[0]),e.vertexWeights.push(l[1]),e.vertexWeights.push(l[2]),e.vertexWeights.push(l[3]),e.vertexWeights.push(l[(u-1)*4]),e.vertexWeights.push(l[(u-1)*4+1]),e.vertexWeights.push(l[(u-1)*4+2]),e.vertexWeights.push(l[(u-1)*4+3]),e.vertexWeights.push(l[u*4]),e.vertexWeights.push(l[u*4+1]),e.vertexWeights.push(l[u*4+2]),e.vertexWeights.push(l[u*4+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[(u-1)*4]),e.weightsIndices.push(c[(u-1)*4+1]),e.weightsIndices.push(c[(u-1)*4+2]),e.weightsIndices.push(c[(u-1)*4+3]),e.weightsIndices.push(c[u*4]),e.weightsIndices.push(c[u*4+1]),e.weightsIndices.push(c[u*4+2]),e.weightsIndices.push(c[u*4+3])),t.color&&(e.colors.push(s[0]),e.colors.push(s[1]),e.colors.push(s[2]),e.colors.push(s[(u-1)*3]),e.colors.push(s[(u-1)*3+1]),e.colors.push(s[(u-1)*3+2]),e.colors.push(s[u*3]),e.colors.push(s[u*3+1]),e.colors.push(s[u*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(a[0]),e.normal.push(a[1]),e.normal.push(a[2]),e.normal.push(a[(u-1)*3]),e.normal.push(a[(u-1)*3+1]),e.normal.push(a[(u-1)*3+2]),e.normal.push(a[u*3]),e.normal.push(a[u*3+1]),e.normal.push(a[u*3+2])),t.uv&&t.uv.forEach(function(h,p){e.uvs[p]===void 0&&(e.uvs[p]=[]),e.uvs[p].push(o[p][0]),e.uvs[p].push(o[p][1]),e.uvs[p].push(o[p][(u-1)*2]),e.uvs[p].push(o[p][(u-1)*2+1]),e.uvs[p].push(o[p][u*2]),e.uvs[p].push(o[p][u*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const a=this;n.forEach(function(s){s.rawTargets.forEach(function(o){const l=D.Objects.Geometry[o.geoID];l!==void 0&&a.genMorphGeometry(e,t,l,i,o.name)})})}genMorphGeometry(e,t,n,i,a){const s=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],o=n.Vertices!==void 0?n.Vertices.a:[],l=n.Indexes!==void 0?n.Indexes.a:[],c=e.attributes.position.count*3,f=new Float32Array(c);for(let v=0;v<l.length;v++){const g=l[v]*3;f[g]=o[v*3],f[g+1]=o[v*3+1],f[g+2]=o[v*3+2]}const u={vertexIndices:s,vertexPositions:f},h=this.genBuffers(u),p=new ye(h.vertex,3);p.name=a||n.attrName,p.applyMatrix4(i),e.morphAttributes.position.push(p)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let a=[];return n==="IndexToDirect"&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:a,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let a=[];return n==="IndexToDirect"&&(a=e.UVIndex.a),{dataSize:2,buffer:i,indices:a,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let a=[];return n==="IndexToDirect"&&(a=e.ColorIndex.a),{dataSize:4,buffer:i,indices:a,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,a=[];for(let s=0;s<i.length;++s)a.push(s);return{dataSize:1,buffer:i,indices:a,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Yt===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new He;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new He;const n=t-1,i=e.KnotVector.a,a=[],s=e.Points.a;for(let u=0,h=s.length;u<h;u+=4)a.push(new at().fromArray(s,u));let o,l;if(e.Form==="Closed")a.push(a[0]);else if(e.Form==="Periodic"){o=n,l=i.length-1-o;for(let u=0;u<n;++u)a.push(a[u])}const f=new Yt(n,i,a,o,l).getPoints(a.length*12);return new He().setFromPoints(f)}}class Xr{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],a=this.addClip(i);e.push(a)}return e}parseClips(){if(D.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=D.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const a={id:i.id,attr:i.attrName,curves:{}};t.set(a.id,a)}}return t}parseAnimationCurves(e){const t=D.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(qr),values:t[n].KeyValueFloat.a},a=G.get(i.id);if(a!==void 0){const s=a.parents[0].ID,o=a.parents[0].relationship;o.match(/X/)?e.get(s).curves.x=i:o.match(/Y/)?e.get(s).curves.y=i:o.match(/Z/)?e.get(s).curves.z=i:o.match(/d|DeformPercent/)&&e.has(s)&&(e.get(s).curves.morph=i)}}}parseAnimationLayers(e){const t=D.Objects.AnimationLayer,n=new Map;for(const i in t){const a=[],s=G.get(parseInt(i));s!==void 0&&(s.children.forEach(function(l,c){if(e.has(l.ID)){const f=e.get(l.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(a[c]===void 0){const u=G.get(l.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(u!==void 0){const h=D.Objects.Model[u.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",l);return}const p={modelName:h.attrName?Je.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Y.traverse(function(v){v.ID===h.id&&(p.transform=v.matrix,v.userData.transformData&&(p.eulerOrder=v.userData.transformData.eulerOrder))}),p.transform||(p.transform=new U),"PreRotation"in h&&(p.preRotation=h.PreRotation.value),"PostRotation"in h&&(p.postRotation=h.PostRotation.value),a[c]=p}}a[c]&&(a[c][f.attr]=f)}else if(f.curves.morph!==void 0){if(a[c]===void 0){const u=G.get(l.ID).parents.filter(function(T){return T.relationship!==void 0})[0].ID,h=G.get(u).parents[0].ID,p=G.get(h).parents[0].ID,v=G.get(p).parents[0].ID,g=D.Objects.Model[v],y={modelName:g.attrName?Je.sanitizeNodeName(g.attrName):"",morphName:D.Objects.Deformer[u].attrName};a[c]=y}a[c][f.attr]=f}}}),n.set(parseInt(i),a))}return n}parseAnimStacks(e){const t=D.Objects.AnimationStack,n={};for(const i in t){const a=G.get(parseInt(i)).children;a.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const s=e.get(a[0].ID);n[i]={name:t[i].attrName,layer:s}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new nr(e.name,-1,t)}generateTracks(e){const t=[];let n=new he,i=new Ke,a=new he;if(e.transform&&e.transform.decompose(n,i,a),n=n.toArray(),i=new ze().setFromQuaternion(i,e.eulerOrder).toArray(),a=a.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,a,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,i){const a=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(a,t,n);return new rr(e+"."+i,a,s)}generateRotationTrack(e,t,n,i,a,s){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(ie.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(ie.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(ie.degToRad));const o=this.getTimesForAllAxes(t),l=this.getKeyframeTrackValues(o,t,n);i!==void 0&&(i=i.map(ie.degToRad),i.push(s),i=new ze().fromArray(i),i=new Ke().setFromEuler(i)),a!==void 0&&(a=a.map(ie.degToRad),a.push(s),a=new ze().fromArray(a),a=new Ke().setFromEuler(a).invert());const c=new Ke,f=new ze,u=[];for(let h=0;h<l.length;h+=3)f.set(l[h],l[h+1],l[h+2],s),c.setFromEuler(f),i!==void 0&&c.premultiply(i),a!==void 0&&c.multiply(a),c.toArray(u,h/3*4);return new ir(e+".quaternion",o,u)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(a){return a/100}),i=Y.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new ar(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let a=1;a<t.length;a++){const s=t[a];s!==i&&(t[n]=s,i=s,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,a=[];let s=-1,o=-1,l=-1;return e.forEach(function(c){if(t.x&&(s=t.x.times.indexOf(c)),t.y&&(o=t.y.times.indexOf(c)),t.z&&(l=t.z.times.indexOf(c)),s!==-1){const f=t.x.values[s];a.push(f),i[0]=f}else a.push(i[0]);if(o!==-1){const f=t.y.values[o];a.push(f),i[1]=f}else a.push(i[1]);if(l!==-1){const f=t.z.values[l];a.push(f),i[2]=f}else a.push(i[2])}),a}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],i=e.values[t]-n,a=Math.abs(i);if(a>=180){const s=a/180,o=i/s;let l=n+o;const c=e.times[t-1],u=(e.times[t]-c)/s;let h=c+u;const p=[],v=[];for(;h<e.times[t];)p.push(h),h+=u,v.push(l),l+=o;e.times=Jt(e.times,t,p),e.values=Jt(e.values,t,v)}}}}class Zr{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new zn,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,a){const s=i.match(/^[\s\t]*;/),o=i.match(/^[\s\t]*$/);if(s||o)return;const l=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),c=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),f=i.match("^\\t{"+(t.currentIndent-1)+"}}");l?t.parseNodeBegin(i,l):c?t.parseNodeProperty(i,c,n[++a]):f?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(l){return l.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:n},s=this.parseNodeAttr(i),o=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,a):n in o?(n==="PoseNode"?o.PoseNode.push(a):o[n].id!==void 0&&(o[n]={},o[n][o[n].id]=o[n]),s.id!==""&&(o[n][s.id]=a)):typeof s.id=="number"?(o[n]={},o[n][s.id]=a):n!=="Properties70"&&(n==="PoseNode"?o[n]=[a]:o[n]=a),typeof s.id=="number"&&(a.id=s.id),s.name!==""&&(a.attrName=s.name),s.type!==""&&(a.attrType=s.type),this.pushStack(a)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),a=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&a===","&&(a=n.replace(/"/g,"").replace(/,$/,"").trim());const s=this.getCurrentNode();if(s.name==="Properties70"){this.parseNodeSpecialProperty(e,i,a);return}if(i==="C"){const l=a.split(",").slice(1),c=parseInt(l[0]),f=parseInt(l[1]);let u=a.split(",").slice(3);u=u.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",a=[c,f],$r(a,u),s[i]===void 0&&(s[i]=[])}i==="Node"&&(s.id=a),i in s&&Array.isArray(s[i])?s[i].push(a):i!=="a"?s[i]=a:s.a=a,this.setCurrentProp(s,i),i==="a"&&a.slice(-1)!==","&&(s.a=ft(a))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=ft(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(f){return f.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=i[0],s=i[1],o=i[2],l=i[3];let c=i[4];switch(s){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=ft(c);break}this.getPrevNode()[a]={type:s,type2:o,flag:l,value:c},this.setCurrentProp(this.getPrevNode(),a)}}class Hr{parse(e){const t=new $t(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new zn;for(;!this.endOfContent(t);){const a=this.parseNode(t,n);a!==null&&i.add(a.name,a)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),a=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const s=e.getUint8(),o=e.getString(s);if(i===0)return null;const l=[];for(let h=0;h<a;h++)l.push(this.parseProperty(e));const c=l.length>0?l[0]:"",f=l.length>1?l[1]:"",u=l.length>2?l[2]:"";for(n.singleProperty=a===1&&e.getOffset()===i;i>e.getOffset();){const h=this.parseNode(e,t);h!==null&&this.parseSubNode(o,n,h)}return n.propertyList=l,typeof c=="number"&&(n.id=c),f!==""&&(n.attrName=f),u!==""&&(n.attrType=u),o!==""&&(n.name=o),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(a,s){s!==0&&i.push(a)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(a){t[a]=n[a]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],a=n.propertyList[1];const s=n.propertyList[2],o=n.propertyList[3];let l;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),a==="Color"||a==="ColorRGB"||a==="Vector"||a==="Vector3D"||a.indexOf("Lcl_")===0?l=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:l=n.propertyList[4],t[i]={type:a,type2:s,flag:o,value:l}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),a=e.getUint32(),s=e.getUint32();if(a===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}typeof Lr=="undefined"&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const o=Ue(new Uint8Array(e.getArrayBuffer(s))),l=new $t(o.buffer);switch(t){case"b":case"c":return l.getBooleanArray(i);case"d":return l.getFloat64Array(i);case"f":return l.getFloat32Array(i);case"i":return l.getInt32Array(i);case"l":return l.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class $t{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let i=0;i<e;i++)t[i]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),wt.decodeText(new Uint8Array(t))}}class zn{add(e,t){this[e]=t}}function Kr(r){const e="Kaydara FBX Binary  \0";return r.byteLength>=e.length&&e===On(r,0,e.length)}function Wr(r){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(i){const a=r[i-1];return r=r.slice(t+i),t++,a}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function Qt(r){const e=/FBXVersion: (\d+)/,t=r.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function qr(r){return r/46186158e3}const Yr=[];function qe(r,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=r;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const a=i*n.dataSize,s=a+n.dataSize;return Qr(Yr,n.buffer,a,s)}const ut=new ze,de=new he;function Rn(r){const e=new U,t=new U,n=new U,i=new U,a=new U,s=new U,o=new U,l=new U,c=new U,f=new U,u=new U,h=new U,p=r.inheritType?r.inheritType:0;if(r.translation&&e.setPosition(de.fromArray(r.translation)),r.preRotation){const F=r.preRotation.map(ie.degToRad);F.push(r.eulerOrder),t.makeRotationFromEuler(ut.fromArray(F))}if(r.rotation){const F=r.rotation.map(ie.degToRad);F.push(r.eulerOrder),n.makeRotationFromEuler(ut.fromArray(F))}if(r.postRotation){const F=r.postRotation.map(ie.degToRad);F.push(r.eulerOrder),i.makeRotationFromEuler(ut.fromArray(F)),i.invert()}r.scale&&a.scale(de.fromArray(r.scale)),r.scalingOffset&&o.setPosition(de.fromArray(r.scalingOffset)),r.scalingPivot&&s.setPosition(de.fromArray(r.scalingPivot)),r.rotationOffset&&l.setPosition(de.fromArray(r.rotationOffset)),r.rotationPivot&&c.setPosition(de.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(u.copy(r.parentMatrix),f.copy(r.parentMatrixWorld));const v=t.clone().multiply(n).multiply(i),g=new U;g.extractRotation(f);const y=new U;y.copyPosition(f);const T=y.clone().invert().multiply(f),w=g.clone().invert().multiply(T),m=a,x=new U;if(p===0)x.copy(g).multiply(v).multiply(w).multiply(m);else if(p===1)x.copy(g).multiply(w).multiply(v).multiply(m);else{const j=new U().scale(new he().setFromMatrixScale(u)).clone().invert(),L=w.clone().multiply(j);x.copy(g).multiply(v).multiply(L).multiply(m)}const P=c.clone().invert(),A=s.clone().invert();let I=e.clone().multiply(l).multiply(c).multiply(t).multiply(n).multiply(i).multiply(P).multiply(o).multiply(s).multiply(a).multiply(A);const d=new U().copyPosition(I),R=f.clone().multiply(d);return h.copyPosition(R),I=h.clone().multiply(x),I.premultiply(f.invert()),I}function Bn(r){r=r||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[r]}function ft(r){return r.split(",").map(function(t){return parseFloat(t)})}function On(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=r.byteLength),wt.decodeText(new Uint8Array(r,e,t))}function $r(r,e){for(let t=0,n=r.length,i=e.length;t<i;t++,n++)r[n]=e[t]}function Qr(r,e,t,n){for(let i=t,a=0;i<n;i++,a++)r[a]=e[i];return r}function Jt(r,e,t){return r.slice(0,e).concat(t).concat(r.slice(e))}const Jr=new Map,Nr=new br;var ti=async(r,e)=>{const t=await sr(Jr,r,()=>new Promise((n,i)=>{or(),Nr.load(r,a=>{Xt(),lr()==="linear"?a.traverse(s=>{var o;!((o=s.material)===null||o===void 0)&&o.map&&(s.material.map.encoding=cr)}):a.traverse(s=>{var o;!((o=s.material)===null||o===void 0)&&o.map&&(s.material.map.encoding=ke)}),n(a)},ur,()=>{Xt(),i()})}));return e?fr(t):t};export{ti as default};
