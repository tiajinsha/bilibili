import{_ as P,$ as V,a0 as f,a1 as _,a2 as n,a3 as h,a4 as b,a5 as v,a6 as C,a7 as R}from"./index.ce3b3605.js";import{g as m}from"./useBVHMap.f1d52297.js";const p=new Set,[g,T]=P();V(function(){const e=m();if(!e.length){const t=f(g);return()=>{t.cancel()}}const o=f(()=>{g();for(const t of p){t.updateMatrixWorld();const c=t.getWorldDirection(_),{start:s,end:i}=h;i.copy(s.copy(t.position)),n.makeEmpty(),n.expandByPoint(s),n.min.addScalar(-.5),n.max.addScalar(.5);const S=b,x=v;let r=0,d=0;for(const B of e)B.shapecast({intersectsBounds:u=>u.intersectsBox(n),intersectsTriangle:u=>{r=u.closestPointToSegment(h,S,x),r<.5&&(d=.5-r,s.addScaledVector(c,d),i.addScaledVector(c,d))}});const l=s.sub(t.position),y=Math.max(0,l.length()-1e-5);l.normalize().multiplyScalar(y),t.position.add(l)}});return()=>{o.cancel()}},[m]);function W(e){var o;const t=this.targetState.get();t&&t._visible===void 0&&(t.outerObject3d.visible=e);for(const a of this.camera.children)((o=a.userData.manager)===null||o===void 0?void 0:o._visible)===void 0&&(a.visible=e)}function M(){if(this.done)return;const e=this.camera;p.add(e),this.then(()=>p.delete(e));let o=!1;this.watch(T(()=>{const t=this.outerObject3d.getWorldPosition(b),a=this.object3d.getWorldPosition(v),c=a.distanceTo(t);e.position.lerp(a,.1);const s=e.position.distanceTo(t)/c;e.position.lerpVectors(t,a,s),e.quaternion.copy(this.object3d.getWorldQuaternion(C));const i=R()?!1:s<.35;i!==o&&W.call(this,!i),o=i}))}export{M as default};
